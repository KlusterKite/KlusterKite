version: '2'
services:
  #set of abstract utility servers
  nuget:
    #image: sunside/simple-nuget-server
    image: clusterkit/nuget
    ports:
     - "81:80"
    environment:
     - NUGET_API_KEY=ClusterKit
  configDb:
    image: clusterkit/postgres
  entry:
    image: clusterkit/entry
    links:
     - "seed"
     - "publisher1"
     - "publisher2"
    ports:
     - "80:80"
     - "443:443"

  #Cluster servers
  seed: #seeds should be limited and with fixed addresses preknown to other cluster nodes
    image: clusterkit/seed
    environment:
     - NETWORK_NAME=seed
     - SELF_JOIN=true
    logging:
        driver: json-file
        options:
            max-size: "1m"

  publisher1: #seeds should be limited and with fixed addresses preknown to other cluster nodes
    image: clusterkit/publisher
    environment:
     - NETWORK_NAME=publisher1
     - SELF_JOIN=true
    logging:
        driver: json-file
        options:
            max-size: "1m"


  publisher2: #seeds should be limited and with fixed addresses preknown to other cluster nodes
    image: clusterkit/publisher
    environment:
     - NETWORK_NAME=publisher2
    logging:
        driver: json-file
        options:
            max-size: "1m"

  manager:
    image: clusterkit/manager
    links:
     - "seed"
     - "configDb"
     - "nuget"   
    logging:
        driver: json-file
        options:
            max-size: "1m"

  monitoringUI:
    image: clusterkit/monitoring-ui
    ports:
     - "82:8080"
    logging:
        driver: json-file
        options:
            max-size: "1m"
  worker:
    image: clusterkit/worker    
    links:
     - "seed"
     - "manager"
     - "nuget"    
     - "configDb"
    logging:
        driver: json-file
        options:
            max-size: "1m"


